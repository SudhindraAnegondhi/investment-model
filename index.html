<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Advanced Rental Property Investment Model</title>

    <!-- External Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- CSS Files -->
    <link rel="stylesheet" href="css/main.css" />
    <link rel="stylesheet" href="css/components.css" />
    <link rel="stylesheet" href="css/responsive.css" />
  </head>
  <body>
    <div class="container">
      <h1>Advanced Rental Property Investment Model</h1>

      <div class="tab-navigation">
        <!-- Mobile/Responsive Tab Menu -->
        <div class="tab-menu-container">
          <button class="tab-menu-toggle" onclick="toggleTabMenu()">
            <span class="menu-icon">‚ò∞</span>
            <span class="current-tab-name">Input Parameters</span>
            <span class="menu-arrow">‚ñº</span>
          </button>
          <div class="tab-dropdown" id="tabDropdown">
            <button class="tab-option active" data-tab="inputs" onclick="selectTab('inputs', 'Input Parameters')">
              üìù Input Parameters
            </button>
            <button class="tab-option" data-tab="dashboard" onclick="selectTab('dashboard', 'üìä Dashboard')">
              üìä Dashboard
            </button>
            <button class="tab-option" data-tab="charts" onclick="selectTab('charts', 'üìà Charts & Analysis')">
              üìà Charts & Analysis
            </button>
            <button class="tab-option" data-tab="scenarios" onclick="selectTab('scenarios', 'üíæ Scenarios')">
              üíæ Scenarios
            </button>
            <button class="tab-option" data-tab="comparison" onclick="selectTab('comparison', 'Strategy Comparison')">
              üìä Strategy Comparison
            </button>
            <button class="tab-option" data-tab="cashflow" onclick="selectTab('cashflow', 'Cash Flow Analysis')">
              üí∞ Cash Flow Analysis
            </button>
            <button class="tab-option" data-tab="sensitivity" onclick="selectTab('sensitivity', 'Sensitivity Analysis')">
              üéØ Sensitivity Analysis
            </button>
            <button class="tab-option" data-tab="breakeven" onclick="selectTab('breakeven', 'Break-Even Analysis')">
              ‚öñÔ∏è Break-Even Analysis
            </button>
            <button class="tab-option" data-tab="roi" onclick="selectTab('roi', 'ROI Analysis')">
              üìà ROI Analysis
            </button>
            <button class="tab-option" data-tab="summary" onclick="selectTab('summary', 'Summary & Download')">
              üìã Summary & Download
            </button>
            <button class="tab-option" data-tab="help" onclick="selectTab('help', 'Help')">
              ‚ùì Help
            </button>
          </div>
        </div>

        <!-- Desktop Tab Bar (Hidden on Mobile) -->
        <div class="desktop-tabs">
          <button class="tab active" onclick="activateTab(this, 'inputs')">
            üìù Input Parameters
          </button>
          <button class="tab" onclick="activateTab(this, 'dashboard')">
            üìä Dashboard
          </button>
          <button class="tab" onclick="activateTab(this, 'charts')">
            üìà Charts & Analysis
          </button>
          <button class="tab" onclick="activateTab(this, 'scenarios')">
            üíæ Scenarios
          </button>
          <button class="tab" onclick="activateTab(this, 'comparison')">
            üìä Strategy Comparison
          </button>
          <button class="tab" onclick="activateTab(this, 'cashflow')">
            üí∞ Cash Flow Analysis
          </button>
          <button class="tab" onclick="activateTab(this, 'sensitivity')">
            üéØ Sensitivity Analysis
          </button>
          <button class="tab" onclick="activateTab(this, 'breakeven')">
            ‚öñÔ∏è Break-Even Analysis
          </button>
          <button class="tab" onclick="activateTab(this, 'roi')">
            üìà ROI Analysis
          </button>
          <button class="tab" onclick="activateTab(this, 'summary')">
            üìã Summary & Download
          </button>
          <button class="tab" onclick="activateTab(this, 'help')">
            ‚ùì Help
          </button>
        </div>
      </div>

      <div id="inputs" class="tab-content active">
        <div class="controls">
          <div class="control-group">
            <label>Annual Investment Budget ($)</label>
            <input type="number" id="annualBudget" value="170000" min="0" />
          </div>
          <div
            class="control-group"
            style="border: 2px solid #667eea; border-radius: 4px; padding: 8px"
          >
            <label style="color: #667eea; font-weight: bold"
              >Investment Budget (Years)</label
            >
            <input
              type="number"
              id="selfPurchaseYears"
              value="3"
              min="0"
              max="30"
            />
          </div>
          <div class="control-group">
            <label>Initial Property Cost ($)</label>
            <input type="number" id="initialCost" value="160000" min="0" />
          </div>
          <div class="control-group">
            <label>Monthly Rent as % of Purchase Price (%)</label>
            <input
              type="number"
              id="rentalRate"
              value="1.9"
              step="0.1"
              min="0"
            />
          </div>
          <div class="control-group">
            <label>Mortgage Interest Rate (%)</label>
            <input
              type="number"
              id="interestRate"
              value="7.00"
              step="0.01"
              min="0"
            />
          </div>
          <div class="control-group">
            <label>Loan-to-Value Ratio (%)</label>
            <input type="number" id="ltvRatio" value="70" min="0" max="100" />
          </div>
          <div class="control-group">
            <label>Loan Term (Years)</label>
            <input type="number" id="loanTerm" value="5" min="1" max="30" />
          </div>
          <div class="control-group">
            <label>Insurance per Unit per Year ($)</label>
            <input type="number" id="insurance" value="1300" min="0" />
          </div>
          <div class="control-group">
            <label>Land Value (% of cost)</label>
            <input
              type="number"
              id="landPercent"
              value="20"
              min="0"
              max="100"
            />
          </div>
          <div class="control-group">
            <label>Maintenance (% of Effective Gross Income)</label>
            <input
              type="number"
              id="maintenanceRate"
              value="1"
              step="0.1"
              min="0"
            />
          </div>
          <div class="control-group">
            <label>Annual Purchase Cost Increase (%)</label>
            <input
              type="number"
              id="costIncrease"
              value="1"
              step="0.1"
              min="0"
            />
          </div>
          <div class="control-group">
            <label>Property Tax Rate (% of assessed value)</label>
            <input
              type="number"
              id="taxRate"
              value="1.5"
              step="0.1"
              min="0"
              max="10"
            />
          </div>
          <div class="control-group">
            <label>Income Tax Rate (%)</label>
            <input
              type="number"
              id="incomeTaxRate"
              value="25"
              min="0"
              max="50"
            />
          </div>
          <div
            class="control-group"
            style="border: 2px solid #28a745; border-radius: 4px; padding: 8px"
          >
            <label style="color: #28a745; font-weight: bold"
              >Passthrough LLC?</label
            >
            <select id="passthroughLLC" style="border-color: #28a745">
              <option value="yes">Yes - No entity taxes</option>
              <option value="no">No - Corporate taxation</option>
            </select>
          </div>
          <div class="control-group">
            <label>Assessed Value at Purchase (% of cost)</label>
            <input
              type="number"
              id="assessedValuePercent"
              value="20"
              min="0"
              max="100"
            />
          </div>
          <div class="control-group">
            <label>Annual Property Appreciation (%)</label>
            <input
              type="number"
              id="appreciationRate"
              value="3"
              step="0.1"
              min="0"
            />
          </div>
          <div
            class="control-group"
            style="border: 2px solid #667eea; border-radius: 4px; padding: 8px"
          >
            <label style="color: #667eea; font-weight: bold"
              >Finance Purchases (Years)</label
            >
            <input
              type="number"
              id="financedPurchaseYears"
              value="5"
              min="0"
              max="30"
            />
          </div>
          <div
            class="control-group"
            style="border: 2px solid #667eea; border-radius: 4px; padding: 8px"
          >
            <label style="color: #667eea; font-weight: bold"
              >Max Units Financed</label
            >
            <input
              type="number"
              id="maxUnitsFinanced"
              value="2"
              min="1"
              max="10"
            />
          </div>
          <div
            class="control-group"
            style="border: 2px solid #667eea; border-radius: 4px; padding: 8px"
          >
            <label style="color: #667eea; font-weight: bold"
              >Max Units Financed Limit (Years)</label
            >
            <input
              type="number"
              id="maxUnitsFinancedLimitYears"
              value="3"
              min="1"
              max="10"
            />
          </div>
          <div class="control-group">
            <label>Annual Rent Growth (%)</label>
            <input
              type="number"
              id="rentGrowthRate"
              value="3"
              step="0.1"
              min="0"
            />
          </div>
          <div class="control-group">
            <label>Vacancy Rate (% of GPR)</label>
            <input
              type="number"
              id="vacancyRate"
              value="5"
              step="0.1"
              min="0"
              max="100"
            />
          </div>
          <div class="control-group">
            <label>Management Fee (% of EGI)</label>
            <input
              type="number"
              id="managementRate"
              value="8"
              step="0.1"
              min="0"
              max="100"
            />
          </div>
          <div class="control-group">
            <label>CapEx Reserves (% of EGI)</label>
            <input
              type="number"
              id="capexRate"
              value="5"
              step="0.1"
              min="0"
              max="100"
            />
          </div>
          <div class="control-group">
            <label>Expense Inflation (Insurance/Other) (%)</label>
            <input
              type="number"
              id="expenseInflation"
              value="2.5"
              step="0.1"
              min="0"
              max="100"
            />
          </div>
          <div class="control-group">
            <label>Insurance Inflation (%)</label>
            <input
              type="number"
              id="insuranceInflation"
              value="4"
              step="0.1"
              min="0"
              max="100"
            />
          </div>
          <div class="control-group">
            <label>Closing Costs (% of Purchase Price)</label>
            <input
              type="number"
              id="closingCostPercent"
              value="2"
              step="0.1"
              min="0"
              max="100"
            />
          </div>
          <div class="control-group">
            <label>Loan Origination Fee (% of Loan)</label>
            <input
              type="number"
              id="loanOriginationPercent"
              value="1"
              step="0.1"
              min="0"
              max="100"
            />
          </div>
          <div class="control-group">
            <label>Assessed Value Growth (%)</label>
            <input
              type="number"
              id="assessedGrowthRate"
              value="2.5"
              step="0.1"
              min="0"
              max="100"
            />
          </div>
        </div>

        <button class="calculate-btn" onclick="calculateAll()">
          Calculate Investment Scenarios
        </button>

        <!-- Current Scenario Display -->
        <div id="current-scenario" style="display: none"></div>
      </div>

      <!-- Dashboard Tab -->
      <div id="dashboard" class="tab-content">
        <h2>üìä Investment Dashboard</h2>

        <!-- Alert System -->
        <div id="alert-container" class="alert-container"></div>

        <!-- KPI Overview -->
        <div class="dashboard">
          <div class="dashboard-section">
            <h3>Self-Financed Strategy KPIs</h3>
            <div class="kpi-grid">
              <div class="kpi-tile">
                <div class="kpi-label">Final Net Worth</div>
                <div class="kpi-value" id="self-net-worth">$0</div>
              </div>
              <div class="kpi-tile">
                <div class="kpi-label">Cumulative Cash Flow</div>
                <div class="kpi-value" id="self-cash-flow">$0</div>
              </div>
              <div class="kpi-tile">
                <div class="kpi-label">Total ROI</div>
                <div class="kpi-value" id="self-roi">0%</div>
              </div>
            </div>
          </div>

          <div class="dashboard-section">
            <h3>Bank-Financed Strategy KPIs</h3>
            <div class="kpi-grid">
              <div class="kpi-tile">
                <div class="kpi-label">Final Net Worth</div>
                <div class="kpi-value" id="financed-net-worth">$0</div>
              </div>
              <div class="kpi-tile">
                <div class="kpi-label">Cumulative Cash Flow</div>
                <div class="kpi-value" id="financed-cash-flow">$0</div>
              </div>
              <div class="kpi-tile">
                <div class="kpi-label">Total ROI</div>
                <div class="kpi-value" id="financed-roi">0%</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Comparison Cards -->
        <div class="comparison-cards">
          <div class="comparison-card self-financed">
            <h4>üè† Self-Financed Advantage</h4>
            <div class="comparison-metrics">
              <div class="metric">
                <div class="metric-label">Net Worth Advantage</div>
                <div class="metric-value" id="net-worth-diff">$0</div>
              </div>
              <div class="metric">
                <div class="metric-label">Cash Flow Advantage</div>
                <div class="metric-value" id="cash-flow-diff">$0</div>
              </div>
            </div>
          </div>

          <div class="comparison-card financed">
            <h4>üè¶ Bank-Financed Benefits</h4>
            <div class="comparison-metrics">
              <div class="metric">
                <div class="metric-label">Leverage Multiplier</div>
                <div class="metric-value" id="leverage-multiplier">1.0x</div>
              </div>
              <div class="metric">
                <div class="metric-label">Units Per Dollar</div>
                <div class="metric-value" id="units-per-dollar">0.0</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Quick Actions -->
        <div class="dashboard-section">
          <h3>Quick Actions</h3>
          <div style="display: flex; gap: 15px; flex-wrap: wrap">
            <button
              class="btn btn-primary"
              onclick="scenarioManager.showSaveDialog()"
            >
              üíæ Save Scenario
            </button>
            <button
              class="btn btn-secondary"
              onclick="workerManager.performSensitivityAnalysis(utils.getInputParameters())"
            >
              üéØ Sensitivity Analysis
            </button>
            <button
              class="btn btn-secondary"
              onclick="workerManager.performMonteCarloSimulation(utils.getInputParameters())"
            >
              üé≤ Monte Carlo Simulation
            </button>
            <button
              class="btn btn-success"
              onclick="exportCurrentResultsToPDF()"
            >
              üìÑ Export PDF Report
            </button>
          </div>
        </div>
      </div>

      <!-- Charts & Analysis Tab -->
      <div id="charts" class="tab-content">
        <h2>üìà Charts & Visual Analysis</h2>

        <div class="charts-grid">
          <!-- Cash Flow Waterfall Chart -->
          <div class="chart-container">
            <h3>Cash Flow Waterfall Analysis</h3>
            <div class="chart-wrapper">
              <canvas id="cashFlowWaterfallChart"></canvas>
            </div>
          </div>

          <!-- Net Worth Progression Chart -->
          <div class="chart-container">
            <h3>Net Worth & Cash Flow Progression</h3>
            <div class="chart-wrapper">
              <canvas id="netWorthChart"></canvas>
            </div>
          </div>

          <!-- Sensitivity Tornado Chart -->
          <div class="chart-container">
            <h3>Sensitivity Analysis</h3>
            <div class="chart-wrapper">
              <canvas id="sensitivityChart"></canvas>
            </div>
          </div>
        </div>

        <!-- Advanced Analysis Results -->
        <div id="sensitivity-results"></div>
        <div id="monte-carlo-results"></div>
      </div>

      <!-- Scenarios Tab -->
      <div id="scenarios" class="tab-content">
        <h2>üíæ Scenario Management</h2>

        <div class="dashboard-section">
          <h3>Scenario Actions</h3>
          <div
            style="
              display: flex;
              gap: 15px;
              flex-wrap: wrap;
              margin-bottom: 20px;
            "
          >
            <button
              class="btn btn-primary"
              onclick="scenarioManager.showSaveDialog()"
            >
              üíæ Save Current Scenario
            </button>
            <button
              class="btn btn-secondary"
              onclick="document.getElementById('import-file').click()"
            >
              üì• Import Scenarios
            </button>
            <button class="btn btn-secondary" onclick="exportAllScenarios()">
              üì§ Export All Scenarios
            </button>
            <input
              type="file"
              id="import-file"
              accept=".json"
              style="display: none"
              onchange="handleScenarioImport(this)"
            />
          </div>
        </div>

        <!-- Scenarios List -->
        <div class="dashboard-section">
          <h3>Saved Scenarios</h3>
          <div id="scenarios-list">
            <div class="no-scenarios">No saved scenarios</div>
          </div>
        </div>

        <!-- Scenario Comparison -->
        <div class="dashboard-section">
          <h3>Scenario Comparison</h3>
          <div id="scenario-comparison">
            <p>Select multiple scenarios to compare their results.</p>
          </div>
        </div>
      </div>

      <div id="comparison" class="tab-content">
        <h2>Strategy Comparison (With Cash Flow Reinvestment)</h2>
        <div class="table-container">
          <table id="comparisonTable">
            <thead>
              <tr>
                <th rowspan="2">Year</th>
                <th rowspan="2">Property<br />Cost</th>
                <th
                  colspan="4"
                  style="
                    background: linear-gradient(45deg, #28a745, #20c997);
                    text-align: center;
                  "
                >
                  Self Financed
                </th>
                <th
                  colspan="6"
                  style="
                    background: linear-gradient(45deg, #667eea, #764ba2);
                    text-align: center;
                  "
                >
                  Bank Financed
                </th>
              </tr>
              <tr>
                <th>New<br />Units</th>
                <th>Total<br />Units</th>
                <th>Cash<br />Flow</th>
                <th>Asset<br />Value</th>
                <th>New<br />Units</th>
                <th>Total<br />Units</th>
                <th>Cash<br />Flow</th>
                <th>Asset<br />Value</th>
                <th>Loan<br />Balance</th>
                <th>Net<br />Equity</th>
              </tr>
            </thead>
            <tbody id="comparisonBody"></tbody>
          </table>
        </div>
      </div>

      <div id="cashflow" class="tab-content">
        <h2>15-Year Cash Flow Projection</h2>
        <div class="table-container">
          <table id="cashflowTable">
            <thead>
              <tr>
                <th rowspan="2">Year</th>
                <th
                  colspan="4"
                  style="
                    background: linear-gradient(45deg, #28a745, #20c997);
                    text-align: center;
                  "
                >
                  Self Financed
                </th>
                <th
                  colspan="4"
                  style="
                    background: linear-gradient(45deg, #667eea, #764ba2);
                    text-align: center;
                  "
                >
                  Bank Financed
                </th>
                <th rowspan="2">Cash Flow<br />Diff</th>
              </tr>
              <tr>
                <th>Cash<br />Flow</th>
                <th>Cumulative</th>
                <th>Asset<br />Value</th>
                <th>Net<br />Worth</th>
                <th>Cash<br />Flow</th>
                <th>Cumulative</th>
                <th>Asset<br />Value</th>
                <th>Net<br />Worth</th>
              </tr>
            </thead>
            <tbody id="cashflowBody"></tbody>
          </table>
        </div>
      </div>

      <div id="sensitivity" class="tab-content">
        <h2>Sensitivity Analysis</h2>
        <p>
          See how changes in key parameters affect your investment outcomes.
          Each parameter is varied by ¬±10%, ¬±20%, and ¬±30% from your base case.
        </p>

        <h3>Net Worth Impact (15-Year)</h3>
        <div class="table-container">
          <table id="sensitivityNetWorthTable">
            <thead>
              <tr>
                <th>Parameter</th>
                <th>-30%</th>
                <th>-20%</th>
                <th>-10%</th>
                <th>Base Case</th>
                <th>+10%</th>
                <th>+20%</th>
                <th>+30%</th>
              </tr>
            </thead>
            <tbody id="sensitivityNetWorthBody"></tbody>
          </table>
        </div>
      </div>

      <div id="breakeven" class="tab-content">
        <h2>Break-Even Analysis</h2>
        <p>
          Understand when your investment becomes profitable and what conditions
          are needed for target returns.
        </p>

        <div class="summary-cards">
          <div class="card">
            <h3>Cash Flow Break-Even</h3>
            <div class="value" id="cashFlowBreakEven">Year 0</div>
            <p>When annual cash flow turns positive</p>
          </div>
          <div class="card">
            <h3>ROI Break-Even</h3>
            <div class="value" id="roiBreakEven">Year 0</div>
            <p>When returns exceed 10% annually</p>
          </div>
        </div>
      </div>

      <div id="summary" class="tab-content">
        <div class="summary-cards">
          <div class="card">
            <h3>Total Units (Self)</h3>
            <div class="value" id="totalSelfUnits">0</div>
          </div>
          <div class="card">
            <h3>Total Units (Financed)</h3>
            <div class="value" id="totalFinancedUnits">0</div>
          </div>
          <div class="card">
            <h3>Self Net Worth</h3>
            <div class="value" id="selfNetWorth">$0</div>
          </div>
          <div class="card">
            <h3>Financed Net Worth</h3>
            <div class="value" id="financedNetWorth">$0</div>
          </div>
          <div class="card">
            <h3>Self Cumulative Cash</h3>
            <div class="value" id="selfCumulative">$0</div>
          </div>
          <div class="card">
            <h3>Financed Cumulative Cash</h3>
            <div class="value" id="financedCumulative">$0</div>
          </div>
        </div>

        <div id="recommendation"></div>

        <div style="text-align: center; margin-top: 30px">
          <a href="#" class="download-btn" onclick="downloadExcel()"
            >Download Excel Report</a
          >
        </div>
      </div>

      <!-- ROI Analysis Tab -->
      <div id="roi" class="tab-content">
        <h2>Return on Investment Analysis</h2>
        <p style="margin-bottom: 20px; color: #666">
          Compare real estate returns against alternative investments
        </p>

        <div id="roiCards">
          <!-- ROI cards will be populated by JavaScript -->
        </div>

        <div class="table-container">
          <h3>Investment Comparison</h3>
          <table>
            <thead>
              <tr>
                <th>Investment Type</th>
                <th>Initial Investment</th>
                <th>Final Value</th>
                <th>Total Return</th>
                <th>Annual ROI</th>
                <th>Risk Level</th>
              </tr>
            </thead>
            <tbody id="roiComparisonBody">
              <tr>
                <td colspan="6" style="text-align: center; color: #666">
                  Run calculations to see ROI comparison
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="table-container">
          <h3>Year-by-Year Value Comparison</h3>
          <table>
            <thead>
              <tr>
                <th>Year</th>
                <th>Real Estate (Self)</th>
                <th>Real Estate (Financed)</th>
                <th>S&P 500</th>
                <th>Bonds</th>
                <th>Savings Account</th>
              </tr>
            </thead>
            <tbody id="roiYearlyBody">
              <tr>
                <td colspan="6" style="text-align: center; color: #666">
                  Run calculations to see yearly comparison
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Help Tab -->
      <div id="help" class="tab-content">
        <h2>Help & Documentation</h2>

        <div
          style="
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
          "
        >
          <h3>üìñ How to Use This Model</h3>
          <ol style="margin-left: 20px; line-height: 1.8">
            <li>
              <strong>Input Parameters:</strong> Set your investment parameters
              in the first tab
            </li>
            <li>
              <strong>Calculate:</strong> Click the "Calculate" button to run
              the analysis
            </li>
            <li>
              <strong>Review Results:</strong> Check all tabs for comprehensive
              analysis
            </li>
            <li>
              <strong>Download:</strong> Export results to Excel for further
              analysis
            </li>
          </ol>
        </div>

        <div
          style="
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
          "
        >
          <div
            style="
              background: white;
              padding: 20px;
              border-radius: 10px;
              box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            "
          >
            <h3>üè† Investment Strategies</h3>
            <p>
              <strong>Self-Financed:</strong> Purchase properties with 100%
              cash, no debt
            </p>
            <p>
              <strong>Bank-Financed:</strong> Use leverage with 70% LTV
              mortgages
            </p>
            <p>
              <strong>Comparison:</strong> Model compares both strategies over
              15 years
            </p>
          </div>

          <div
            style="
              background: white;
              padding: 20px;
              border-radius: 10px;
              box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            "
          >
            <h3>üí∞ Key Metrics Explained</h3>
            <p><strong>Cash Flow:</strong> Annual income minus expenses</p>
            <p><strong>Net Worth:</strong> Property value + cash - debt</p>
            <p><strong>ROI:</strong> Annualized return on investment</p>
            <p>
              <strong>Break-Even:</strong> Year when strategy becomes profitable
            </p>
          </div>

          <div
            style="
              background: white;
              padding: 20px;
              border-radius: 10px;
              box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            "
          >
            <h3>üìä Analysis Tabs</h3>
            <p>
              <strong>Strategy Comparison:</strong> Side-by-side year-by-year
              comparison
            </p>
            <p>
              <strong>Cash Flow Analysis:</strong> Detailed cash flow breakdown
            </p>
            <p>
              <strong>Sensitivity Analysis:</strong> Impact of parameter changes
            </p>
            <p><strong>Break-Even Analysis:</strong> Profitability timeline</p>
            <p>
              <strong>ROI Analysis:</strong> Returns vs alternative investments
            </p>
          </div>

          <div
            style="
              background: white;
              padding: 20px;
              border-radius: 10px;
              box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            "
          >
            <h3>‚öôÔ∏è Important Parameters</h3>
            <p>
              <strong>Annual Budget:</strong> Available cash for investments
            </p>
            <p>
              <strong>Rental Rate:</strong> Monthly rent as % of property cost
            </p>
            <p><strong>Interest Rate:</strong> Mortgage interest rate</p>
            <p><strong>LTV Ratio:</strong> Loan-to-value ratio for financing</p>
            <p>
              <strong>Appreciation Rate:</strong> Annual property value growth
            </p>
          </div>
        </div>

        <div
          style="
            background: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            border-left: 4px solid #2196f3;
          "
        >
          <h3>üí° Tips for Best Results</h3>
          <ul style="margin-left: 20px; line-height: 1.8">
            <li>
              Use realistic rental rates (typically 0.8-1.2% of property value)
            </li>
            <li>Consider local market conditions for appreciation rates</li>
            <li>Account for property management and maintenance costs</li>
            <li>Factor in tax implications of your investment structure</li>
            <li>
              Compare results with your investment goals and risk tolerance
            </li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Year Detail Modal -->
    <div id="yearModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <button
            class="nav-btn"
            id="prevYearBtn"
            onclick="navigateToYear(utils.currentModalIndex - 1)"
            title="Previous Year"
          >
            &lt;
          </button>
          <div class="modal-title">
            <h2>Year <span id="modalYear"></span> - Detailed Analysis</h2>
          </div>
          <div class="modal-controls">
            <select
              id="strategySelect"
              class="modal-dropdown"
              onchange="switchStrategy(this.value)"
            >
              <option value="self">Self-Financed</option>
              <option value="financed">Bank-Financed</option>
            </select>
            <select
              id="statementSelect"
              class="modal-dropdown"
              onchange="showModalTab(this.value)"
            >
              <option value="pl">P&L Statement</option>
              <option value="balance">Balance Sheet</option>
              <option value="cashflow">Cash Flow</option>
            </select>
            <button
              class="nav-btn"
              id="nextYearBtn"
              onclick="navigateToYear(utils.currentModalIndex + 1)"
              title="Next Year"
            >
              &gt;
            </button>
            <span class="close" onclick="closeModal()">&times;</span>
          </div>
        </div>

        <div class="modal-body">
          <div class="modal-selection-display">
            <span id="selectedStrategy">Self-Financed</span> ‚Ä¢
            <span id="selectedStatement">P&L Statement</span>
          </div>

          <div id="plContent" class="modal-tab-content active">
            <table class="pl-table" id="plTable">
              <thead>
                <tr>
                  <th>Item</th>
                  <th>Amount</th>
                </tr>
              </thead>
              <tbody id="plBody"></tbody>
            </table>
          </div>

          <div id="balanceContent" class="modal-tab-content">
            <table class="balance-table" id="balanceTable">
              <thead>
                <tr>
                  <th>Item</th>
                  <th>Amount</th>
                </tr>
              </thead>
              <tbody id="balanceBody"></tbody>
            </table>
          </div>

          <div id="cashflowContent" class="modal-tab-content">
            <table class="cashflow-table" id="cashflowTable">
              <thead>
                <tr>
                  <th>Cash Flow Item</th>
                  <th>Amount</th>
                </tr>
              </thead>
              <tbody id="modalCashflowBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- JavaScript Files -->
    <script src="js/core/utils.js"></script>
    <script src="js/core/data-model.js"></script>
    <script src="js/core/calculations.js"></script>
    <script src="js/components/ui-manager.js"></script>
    <script src="test-modal-debug.js"></script>
    <script src="js/components/export.js"></script>
    <script src="js/components/worker-manager.js"></script>
    <script src="js/modules/roi-analysis.js"></script>
    <script src="js/modules/sensitivity-analysis.js"></script>
    <script src="js/modules/balance-sheet.js"></script>
    <script src="js/modules/charts.js"></script>
    <script src="js/modules/scenario-manager.js"></script>
    <script src="js/modules/pdf-export.js"></script>
    <script src="js/app.js"></script>

    <!-- Helper Functions for UI -->
    <script>
      // Scenario import/export helper functions
      function exportAllScenarios() {
        try {
          const exportData = scenarioManager.exportScenarios();
          const blob = new Blob([exportData], { type: "application/json" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = `investment-scenarios-${
            new Date().toISOString().split("T")[0]
          }.json`;
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        } catch (error) {
          alert("Error exporting scenarios: " + error.message);
        }
      }

      function handleScenarioImport(input) {
        const file = input.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function (e) {
          try {
            const result = scenarioManager.importScenarios(e.target.result, {
              generateNewIds: true,
              renameDuplicates: true,
            });

            let message = `Successfully imported ${result.imported.length} scenarios.`;
            if (result.errors.length > 0) {
              message += `\n${result.errors.length} scenarios failed to import.`;
            }
            alert(message);
          } catch (error) {
            alert("Error importing scenarios: " + error.message);
          }
        };
        reader.readAsText(file);
        input.value = ""; // Reset file input
      }

      // Initialize enhanced features when page loads
      document.addEventListener("DOMContentLoaded", function () {
        // Initialize worker manager
        workerManager.initWorker();

        // Load scenario list
        scenarioManager.updateScenariosList();

        // Add window resize handler for charts
        window.addEventListener("resize", function () {
          if (window.chartManager) {
            chartManager.resizeCharts();
          }
        });
      });

      // Tab Menu Functions
      function toggleTabMenu() {
        const dropdown = document.getElementById('tabDropdown');
        const toggle = document.querySelector('.tab-menu-toggle');
        
        if (dropdown.classList.contains('show')) {
          dropdown.classList.remove('show');
          toggle.classList.remove('active');
        } else {
          dropdown.classList.add('show');
          toggle.classList.add('active');
        }
      }

      function selectTab(tabId, tabName) {
        // Update current tab name
        document.querySelector('.current-tab-name').textContent = tabName;
        
        // Update active state in dropdown
        document.querySelectorAll('.tab-option').forEach(option => {
          option.classList.remove('active');
        });
        document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
        
        // Close dropdown
        const dropdown = document.getElementById('tabDropdown');
        const toggle = document.querySelector('.tab-menu-toggle');
        dropdown.classList.remove('show');
        toggle.classList.remove('active');
        
        // Activate the tab (reuse existing function)
        const fakeButton = { classList: { remove: () => {}, add: () => {} } };
        activateTab(fakeButton, tabId);
      }

      // Close dropdown when clicking outside
      document.addEventListener('click', function(event) {
        const menuContainer = document.querySelector('.tab-menu-container');
        if (menuContainer && !menuContainer.contains(event.target)) {
          const dropdown = document.getElementById('tabDropdown');
          const toggle = document.querySelector('.tab-menu-toggle');
          if (dropdown && toggle) {
            dropdown.classList.remove('show');
            toggle.classList.remove('active');
          }
        }
      });

      // Enhanced calculateAll that updates charts after calculation
      function calculateAll() {
        try {
          const params = utils.getInputParameters();
          const validation = dataModel.validateInvestmentParameters(params);

          if (!validation.isValid) {
            alert(
              "Please fix the following errors:\n" +
                validation.errors.join("\n")
            );
            return;
          }

          console.log(
            "üîç CALCULATE ALL: Using worker manager for calculations"
          );

          // Use worker manager for calculations (which will use worker or fall back to main thread)
          if (
            window.workerManager &&
            typeof workerManager.calculateScenarios === "function"
          ) {
            workerManager.calculateScenarios(params);
          } else {
            console.warn(
              "üîç WORKER MANAGER NOT AVAILABLE, using direct calculation"
            );
            // Fallback to direct calculation
            const results = calculations.performCalculations(params);
            utils.calculationResults = results;

            if (typeof updateAllTables === "function") {
              updateAllTables();
            }
          }
        } catch (error) {
          console.error("Calculation error:", error);
          if (typeof utils.handleError === "function") {
            utils.handleError(error, "calculateAll");
          }
          alert(
            "An error occurred during calculations. Please check the console for details."
          );
        }
      }
    </script>
  </body>
</html>
